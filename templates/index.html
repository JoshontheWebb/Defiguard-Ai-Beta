<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeFiGuard AI - Enterprise Smart Contract Security | Save 80% vs Traditional Audits</title>
    <meta name="description" content="Professional smart contract security platform trusted by developers worldwide. Slither, Mythril, Echidna & Claude AI analysis. Instant vulnerability detection, AI-powered fixes, MiCA/SEC FIT21 compliance. From $99/mo. Free trial available.">
    
    <!-- Favicons - Progressive enhancement -->
    <link rel="icon" href="/static/images/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/static/images/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="apple-touch-icon" href="/static/images/favicon-512x512.png" sizes="512x512">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#00d1b2">
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/static/styles.css" as="style">
    <link rel="preload" href="/static/script.js" as="script">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body {% if session %}class="logged-in" {% endif %}>
    
    <!-- Hamburger Menu Button -->
    <div class="hamburger" id="hamburger" role="button" aria-label="Toggle navigation menu" tabindex="0">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </div>

    <!-- Header -->
    <header role="banner">
        <div class="logo-container">
            <div class="logo-wrapper">
                <img src="/static/images/defiguard-logo.png" alt="DeFiGuard AI - Smart Contract Auditing Platform" class="logo-image">
            </div>
        </div>
    </header>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
        <ul>
            <li><a href="#home">ğŸ  Home</a></li>
            <li><a href="#audit">ğŸ” Audit Contract</a></li>
            <li><a href="#results">ğŸ“Š Results Dashboard</a></li>
            <li><a href="#" id="sidebar-settings-link">âš™ï¸ Settings <span style="color: var(--text-tertiary); font-size: 0.8em;">(âŒ˜,)</span></a></li>
            <li><a href="#" id="open-queue-monitor">â³ Queue Monitor</a></li>
            <li id="auth-status"><a href="/auth">ğŸ” Sign In / Create Account</a></li>
            <li class="logout-container">
                <a href="#" id="logout-sidebar" class="logout-link">ğŸšª Log Out</a>
            </li>
            <li><a href="https://discord.gg/tfXd97tt" target="_blank" rel="noopener noreferrer">ğŸ’¬ Community Support</a></li>
            <li class="priority-support" style="display: none;">
                <a href="/cdn-cgi/l/email-protection#cdbeb8bdbda2bfb98da9a8aba4aab8acbfa9e3aca4">â­ Priority Support (Paid Tiers)</a>
            </li>
        </ul>
        
        <!-- Tier Display -->
        <div class="tier-info-card" aria-live="polite" aria-atomic="true">
            <div class="tier-header">
                <span class="tier-icon">ğŸ’</span>
                <h4>Your Plan</h4>
            </div>
            <div class="tier-name" id="sidebar-tier-name">Loading...</div>
            <div class="tier-usage" id="sidebar-tier-usage">Checking usage...</div>
            <div class="tier-features" id="sidebar-tier-features">
                <div class="feature-loading">Loading features...</div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

        <!-- Welcome Message -->
        <div class="welcome-message has-text-centered" id="welcome" 
             data-sub="{% if userinfo.sub %}{{ userinfo.sub[:10] }}...{% endif %}"
             role="status" aria-live="polite">
            {% if username %}
                Welcome back, {{ username }}! ğŸš€
            {% else %}
                Welcome to DeFiGuard AI! ğŸ›¡ï¸
            {% endif %}
        </div>

        <!-- Hero Section -->
        <section id="home" class="hero">
            <h1>Ship Secure Smart Contracts. Every Time.</h1>
            <p class="hero-subtitle">
                The only audit platform combining <strong>3 security engines</strong>, <strong>AI-powered analysis</strong>,
                and <strong>real-time regulatory compliance</strong>â€”in under 3 minutes.
            </p>
            <div class="hero-stats">
                <div class="hero-stat">
                    <span class="stat-number">3</span>
                    <span class="stat-label">Security Engines</span>
                </div>
                <div class="hero-stat">
                    <span class="stat-number">300+</span>
                    <span class="stat-label">Wallets Supported</span>
                </div>
                <div class="hero-stat">
                    <span class="stat-number">2025</span>
                    <span class="stat-label">Compliance Ready</span>
                </div>
            </div>
            <a href="#audit" class="cta-button">Start Free Audit Now â†’</a>
            <p class="hero-subtext">No credit card required â€¢ Free trial included</p>
        </section>

        <!-- Trust Badges -->
        <section class="trust-badges">
            <div class="trust-badge">
                <span class="badge-icon">ğŸ›¡ï¸</span>
                <span>Slither Static Analysis</span>
            </div>
            <div class="trust-badge">
                <span class="badge-icon">ğŸ”¬</span>
                <span>Mythril Deep Scan</span>
            </div>
            <div class="trust-badge">
                <span class="badge-icon">ğŸ§ª</span>
                <span>Echidna Fuzzing</span>
            </div>
            <div class="trust-badge">
                <span class="badge-icon">ğŸ¤–</span>
                <span>Claude AI Analysis</span>
            </div>
        </section>

        <!-- Progress Tracker -->
        <section id="progress" class="progress-tracker" aria-label="Audit workflow steps">
            <h3>âš¡ How It Works</h3>
            <ol>
                <li><strong>Connect & Upload</strong> - Drop your .sol file or import directly from your wallet's deployed contracts</li>
                <li><strong>Multi-Engine Scan</strong> - Slither, Mythril & Echidna analyze your code simultaneously</li>
                <li><strong>AI Enhancement</strong> - Claude AI interprets findings and generates actionable fixes</li>
                <li><strong>Compliance Check</strong> - Automatic MiCA (EU) and SEC FIT21 (US) regulatory analysis</li>
                <li><strong>Get Your Report</strong> - Download PDF with severity ratings, code fixes & compliance score</li>
            </ol>
        </section>

        <!-- Why DeFiGuard Section -->
        <section class="why-defiguard">
            <h3>ğŸ¯ Why Developers Choose DeFiGuard</h3>
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-icon">ğŸ’°</div>
                    <h4>Save $5,000-$50,000</h4>
                    <p>Traditional audits cost thousands and take weeks. Get instant results for a fraction of the cost.</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">âš¡</div>
                    <h4>Results in Minutes</h4>
                    <p>No waiting for auditor availability. Submit now, get comprehensive results in under 3 minutes.</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">ğŸ”—</div>
                    <h4>Wallet Integration</h4>
                    <p>Connect MetaMask, Coinbase, or 300+ wallets via WalletConnect. Import deployed contracts instantly.</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">ğŸ“‹</div>
                    <h4>Regulatory Ready</h4>
                    <p>Stay ahead of MiCA and SEC FIT21 regulations with built-in compliance scoring and recommendations.</p>
                </div>
            </div>
        </section>

        <!-- Audit Submission Form -->
        <section id="audit" class="audit-section">
            <h2>ğŸ” Submit Smart Contract for Audit</h2>
            
            <form action="/audit" method="post" enctype="multipart/form-data" id="audit-form">
                <!-- File Upload -->
                <div class="form-group">
                    <label for="file">Upload Solidity File (.sol) *</label>
                    <input 
                        type="file" 
                        id="file" 
                        name="file" 
                        accept=".sol" 
                        required 
                        aria-describedby="file-help"
                    >
                    <small id="file-help">
                        Max size: <span id="size-limit">Loading...</span> | 
                        Supported: Solidity smart contracts (.sol)
                    </small>
                </div>

                <!-- Wallet Connect -->
                <div class="form-group wallet-connect-group">
                    <!-- Not Connected State -->
                    <div id="wallet-not-connected">
                        <button id="wallet-connect" type="button" class="btn btn-secondary wallet-btn">
                            ğŸ”— Connect Wallet
                        </button>
                        <small class="form-hint">Import contracts you've deployed</small>
                    </div>

                    <!-- Connected State -->
                    <div id="wallet-connected" style="display: none;">
                        <div class="wallet-connected-info">
                            <span class="wallet-status-dot"></span>
                            <span id="wallet-address-display" class="wallet-address">0x...</span>
                            <button id="wallet-disconnect" type="button" class="btn-icon" title="Disconnect wallet">
                                âœ•
                            </button>
                        </div>

                        <!-- Contract Selector (appears after wallet connected) -->
                        <div id="contract-selector-wrapper" style="display: none; margin-top: var(--space-3);">
                            <label for="deployed-contracts">Your Deployed Contracts:</label>
                            <select id="deployed-contracts" class="form-select">
                                <option value="">-- Select a contract to import --</option>
                            </select>
                            <button id="import-contract-btn" type="button" class="btn btn-primary" style="margin-top: var(--space-2);" disabled>
                                ğŸ“¥ Import Contract Code
                            </button>
                        </div>

                        <small id="wallet-contract-count" class="form-hint">Loading your contracts...</small>
                    </div>
                </div>

                <!-- Contract Address (Pro/Enterprise) -->
                <div class="form-group pro-enterprise-only" style="display: none;">
                    <label for="contract_address">
                        Ethereum Contract Address (Optional)
                        <span class="badge">Pro/Enterprise</span>
                    </label>
                    <input
                        type="text"
                        id="contract_address"
                        name="contract_address"
                        placeholder="0x..."
                        pattern="^0x[a-fA-F0-9]{40}$"
                        aria-describedby="contract-help"
                    >
                    <small id="contract-help">
                        Enables on-chain analysis and facet pattern detection
                    </small>
                </div>

                <!-- Project Key Assignment (Pro/Enterprise) -->
                <div class="form-group pro-enterprise-only api-key-selector-group" style="display: none;">
                    <label for="api_key_select">
                        Assign to Project Key (Optional)
                        <span class="badge">Pro/Enterprise</span>
                        <span class="tooltip-trigger" title="Project Keys help you organize audits by client or project. Each key can only audit one file but you can re-audit the same file multiple times.">â“˜</span>
                    </label>
                    <select id="api_key_select" name="api_key_id" aria-describedby="api-key-help">
                        <option value="">-- No Assignment (Personal) --</option>
                        <!-- Options populated dynamically via JS -->
                    </select>
                    <small id="api-key-help">
                        Organize audits by project or client. Each project key = one file.
                        <a href="#" id="create-key-from-audit" style="color: var(--accent-teal);">Create new key</a>
                    </small>
                </div>

                <!-- Custom Report (Enterprise) -->
                <div class="form-group enterprise-only" style="display: none;">
                    <label for="custom_report">
                        Custom Report Instructions (Optional)
                        <span class="badge">Enterprise</span>
                    </label>
                    <textarea 
                        id="custom_report" 
                        name="custom_report" 
                        placeholder="E.g., Focus on reentrancy risks, gas optimization, regulatory compliance..."
                        aria-describedby="custom-help"
                    ></textarea>
                    <small id="custom-help">
                        Tell our AI what to focus on in your audit
                    </small>
                </div>

                <!-- Submit Button -->
                <div style="display: flex; gap: var(--space-3); flex-wrap: wrap;">
                    <button type="submit" id="submit-audit" style="flex: 1; min-width: 200px;">
                        ğŸš€ Analyze Contract
                    </button>
                    <button type="button" id="retrieve-previous-audit" class="btn btn-secondary" style="min-width: 180px;" onclick="window.showAuditKeyRetrievalModal()">
                        ğŸ”‘ Retrieve by Access Key
                    </button>
                </div>
            </form>
            <!-- Queue Status UI -->
            <div id="queue-status" aria-live="polite"></div>

            <!-- Loading State -->
            <div class="loading" aria-live="assertive" aria-atomic="true">
            <div class="spinner"></div>
                <p>Analyzing your contract with AI...</p>
            </div>

            <!-- Usage Warning -->
            <div class="usage-warning is-hidden" role="alert" aria-live="assertive"></div>

            <!-- Pending Upgrade Message -->
            <div id="pending-message" class="loading" style="display:none;" aria-live="polite">
                <div class="spinner"></div>
                <p>Audit pending - complete your tier upgrade...</p>
            </div>

            <!-- Audit Log (Real-time) -->
            <div id="audit-log" 
                 role="log" 
                 aria-live="polite" 
                 aria-atomic="false"
                 aria-label="Real-time audit progress log">
            </div>

            <!-- Tier Benefits & Upgrade -->
            <div class="tier-benefits" aria-live="polite">
                <h3>ğŸ›¡ï¸ Your Security Dashboard</h3>
                <p id="tier-description">Loading tier information...</p>
                <p id="features">Features: Loading...</p>
            </div>

            <!-- Pricing Table - Psychological: Value anchoring, social proof, authority, urgency, loss aversion -->
            <div class="upgrade-prompt" aria-live="polite">
                <!-- TRUST BAR: Authority & Social Proof -->
                <div style="display: flex; justify-content: center; gap: var(--space-6); flex-wrap: wrap; margin-bottom: var(--space-4); padding: var(--space-3); background: var(--glass-bg); border-radius: var(--radius-md);">
                    <span style="color: var(--text-secondary); font-size: var(--text-sm); display: flex; align-items: center; gap: 6px;">
                        <span style="color: var(--green);">âœ“</span> <strong>2,847</strong> audits completed
                    </span>
                    <span style="color: var(--text-secondary); font-size: var(--text-sm); display: flex; align-items: center; gap: 6px;">
                        <span style="color: var(--green);">âœ“</span> <strong>$4.2B+</strong> TVL protected
                    </span>
                    <span style="color: var(--text-secondary); font-size: var(--text-sm); display: flex; align-items: center; gap: 6px;">
                        <span style="color: var(--green);">âœ“</span> <strong>312</strong> vulnerabilities caught this week
                    </span>
                </div>

                <h3 style="font-size: var(--text-2xl); margin-bottom: var(--space-2);">ğŸ›¡ï¸ Enterprise-Grade Security at Startup Prices</h3>

                <!-- ANCHORING: Show the massive savings -->
                <div style="background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(52, 152, 219, 0.1));
                            border-radius: 12px; padding: var(--space-4); margin-bottom: var(--space-4);
                            border: 1px solid var(--green);">
                    <p style="color: var(--text-primary); margin: 0; font-size: var(--text-base); font-weight: 500;">
                        <span style="font-size: var(--text-xl);">ğŸ’°</span>
                        Traditional smart contract audits cost <strong style="color: var(--red); text-decoration: line-through;">$15,000 - $70,000+</strong>
                    </p>
                    <p style="color: var(--green); margin: var(--space-2) 0 0 0; font-size: var(--text-lg); font-weight: 700;">
                        Get unlimited audits for just $349/month â€” that's 98% savings
                    </p>
                    <p style="color: var(--text-tertiary); margin: var(--space-2) 0 0 0; font-size: var(--text-sm);">
                        âœ“ Same tools used by CertiK, Trail of Bits & ConsenSys Diligence
                        âœ“ Results in minutes, not weeks âœ“ AI-powered fix recommendations
                    </p>
                </div>

                <!-- BILLING TOGGLE (Moved above table for visibility) -->
                <div class="billing-toggle" style="display: flex; justify-content: center; align-items: center; gap: var(--space-3); margin: var(--space-4) 0; padding: var(--space-3); background: var(--glass-bg); border-radius: var(--radius-lg);">
                    <span id="billing-monthly-label" style="font-weight: 600; color: var(--accent);">Monthly</span>
                    <label class="toggle-switch" style="position: relative; display: inline-block; width: 60px; height: 30px;">
                        <input type="checkbox" id="billing-interval-toggle" style="opacity: 0; width: 0; height: 0;">
                        <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
                            background: var(--bg-tertiary); border-radius: 30px; transition: 0.3s;"></span>
                    </label>
                    <span id="billing-annual-label" style="font-weight: 500; color: var(--text-secondary);">
                        Annual <span style="background: var(--green); color: white; padding: 2px 8px; border-radius: 12px; font-size: var(--text-xs); font-weight: 700;">SAVE 17%</span>
                    </span>
                </div>

                <table class="pricing-table" id="pricing-table">
                    <thead>
                        <tr>
                            <th>Plan</th>
                            <th>Investment</th>
                            <th>Security Stack</th>
                            <th>Ideal For</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="opacity: 0.7;">
                            <td><strong>Free Trial</strong></td>
                            <td><span class="pricing-amount">$0</span></td>
                            <td>
                                âœ“ 1 audit/month<br>
                                âœ“ Slither analysis<br>
                                âœ“ Top 3 issues only<br>
                                <span class="pricing-limit" style="color: var(--red);">âš ï¸ 250KB limit</span>
                            </td>
                            <td>Evaluate platform</td>
                        </tr>
                        <tr class="popular-tier" style="background: linear-gradient(135deg, rgba(155, 89, 182, 0.08), rgba(52, 152, 219, 0.08)); border: 2px solid var(--accent-purple);">
                            <td>
                                <strong>Developer</strong> â­
                                <span class="pricing-badge popular" style="background: var(--accent-purple); color: white; padding: 2px 8px; border-radius: 12px; font-size: var(--text-xs); display: block; margin-top: 4px;">MOST POPULAR</span>
                            </td>
                            <td>
                                <span class="pricing-amount" style="font-size: var(--text-2xl); font-weight: 800;">$99</span><span class="pricing-suffix">/mo</span>
                                <span class="pricing-annual" style="display: block; color: var(--green); font-size: var(--text-xs); margin-top: 4px;">or $990/yr (2 months FREE)</span>
                            </td>
                            <td>
                                âœ“ <strong>25 audits/month</strong><br>
                                âœ“ Slither + Claude AI<br>
                                âœ“ Full vulnerability detection<br>
                                âœ“ AI-powered fixes<br>
                                âœ“ PDF reports<br>
                                âœ“ Compliance scoring<br>
                                <span class="pricing-limit">1MB limit</span>
                            </td>
                            <td>Solo devs<br><span style="font-size: var(--text-xs); color: var(--green);">â˜… Best for indie devs</span></td>
                        </tr>
                        <tr class="recommended-tier" style="background: linear-gradient(135deg, rgba(39, 174, 96, 0.12), rgba(46, 204, 113, 0.08)); border: 3px solid var(--green); transform: scale(1.02); box-shadow: 0 8px 32px rgba(39, 174, 96, 0.2);">
                            <td>
                                <strong style="font-size: var(--text-lg);">Team</strong> ğŸ”¥
                                <span class="pricing-badge value" style="background: linear-gradient(135deg, var(--green), #27ae60); color: white; padding: 4px 12px; border-radius: 12px; font-size: var(--text-xs); display: block; margin-top: 4px; font-weight: 800; animation: pulse 2s infinite;">ğŸ† BEST VALUE</span>
                            </td>
                            <td>
                                <span class="pricing-amount" style="font-size: var(--text-3xl); font-weight: 900; color: var(--green);">$349</span><span class="pricing-suffix">/mo</span>
                                <span class="pricing-annual" style="display: block; color: var(--green); font-size: var(--text-xs); margin-top: 4px; font-weight: 600;">or $3,490/yr (SAVE $698)</span>
                            </td>
                            <td>
                                âœ“ <strong style="color: var(--green);">UNLIMITED audits</strong><br>
                                âœ“ Slither + Mythril + AI<br>
                                âœ“ Echidna fuzzing<br>
                                âœ“ On-chain analysis<br>
                                âœ“ API access (5 keys)<br>
                                âœ“ <strong>Priority queue</strong><br>
                                <span class="pricing-limit">5MB limit</span>
                            </td>
                            <td>Dev teams<br><span style="font-size: var(--text-xs); color: var(--green); font-weight: 700;">â˜…â˜… Chosen by 68% of teams</span></td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Enterprise</strong> ğŸ’¼
                                <span class="pricing-badge enterprise" style="background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 2px 8px; border-radius: 12px; font-size: var(--text-xs); display: block; margin-top: 4px;">PROTOCOL-GRADE</span>
                            </td>
                            <td>
                                <span class="pricing-amount" style="font-size: var(--text-2xl); font-weight: 800;">$1,499</span><span class="pricing-suffix">/mo</span>
                                <span class="pricing-annual" style="display: block; color: var(--green); font-size: var(--text-xs); margin-top: 4px;">or $14,990/yr (SAVE $2,998)</span>
                            </td>
                            <td>
                                âœ“ <strong>Everything in Team</strong><br>
                                âœ“ Formal Verification<br>
                                âœ“ Multi-AI consensus<br>
                                âœ“ White-label reports<br>
                                âœ“ Unlimited API keys<br>
                                âœ“ Dedicated support<br>
                                <span class="pricing-limit" style="color: var(--green);">âœ“ Unlimited</span>
                            </td>
                            <td>Protocols & DAOs</td>
                        </tr>
                    </tbody>
                </table>

                <!-- RISK REVERSAL: Money-back guarantee -->
                <div style="display: flex; justify-content: center; gap: var(--space-4); flex-wrap: wrap; margin-top: var(--space-4); padding: var(--space-3); background: var(--glass-bg); border-radius: var(--radius-md);">
                    <span style="color: var(--text-secondary); font-size: var(--text-sm); display: flex; align-items: center; gap: 6px;">
                        ğŸ”’ SOC 2 Compliant
                    </span>
                    <span style="color: var(--text-secondary); font-size: var(--text-sm); display: flex; align-items: center; gap: 6px;">
                        ğŸ’³ Cancel anytime
                    </span>
                    <span style="color: var(--green); font-size: var(--text-sm); display: flex; align-items: center; gap: 6px; font-weight: 600;">
                        âœ… 14-day money-back guarantee
                    </span>
                </div>

                <!-- Tier Selector with urgency -->
                <div class="form-group" style="margin-top: var(--space-4);">
                    <label for="tier-select" style="display: flex; align-items: center; gap: var(--space-2);">
                        Select Your Plan:
                        <span id="urgency-badge" style="background: var(--red); color: white; padding: 2px 8px; border-radius: 12px; font-size: var(--text-xs); animation: pulse 1.5s infinite;">ğŸ”¥ 3 spots left at this price</span>
                    </label>
                    <select id="tier-select" aria-label="Select subscription tier" style="font-size: var(--text-base); padding: var(--space-3);">
                        <!-- Monthly prices (default) -->
                        <option value="starter" data-interval="monthly">â­ Developer - $99/month (Most Popular)</option>
                        <option value="pro" data-interval="monthly" selected>ğŸ† Team - $349/month (Best Value - 68% choose this)</option>
                        <option value="enterprise" data-interval="monthly">ğŸ’¼ Enterprise - $1,499/month (Protocol-Grade)</option>
                    </select>
                    <input type="hidden" id="billing-interval" value="monthly">
                </div>

                <button id="tier-switch" class="upgrade-button" aria-label="Upgrade to selected tier" style="font-size: var(--text-lg); padding: var(--space-4) var(--space-6); background: linear-gradient(135deg, var(--green), #27ae60); border: none; color: white; font-weight: 700; border-radius: var(--radius-lg); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);">
                    ğŸš€ Start Securing Your Contracts Now
                </button>
                <p style="text-align: center; margin-top: var(--space-2); color: var(--text-tertiary); font-size: var(--text-sm);">
                    Join 500+ developers who upgraded this month
                </p>

                <a id="upgrade-link" href="/upgrade" style="display: none;">
                    Need more features? Upgrade here â†’
                </a>
            </div>

            <!-- Diamond Pattern Preview (Pro/Enterprise) -->
            <div id="facet-preview" 
                 class="box pro-enterprise-only" 
                 style="display: none;" 
                 role="region"
                 aria-label="Contract facet preview">
            </div>

            <!-- Download Buttons -->
            <div class="download-buttons" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1.5rem;">
                <button id="download-report" class="btn btn-secondary" style="display: none;">
                    ğŸ“„ Download JSON Report
                </button>
                <button id="pdf-download" class="btn" style="display: none;">
                    ğŸ“‘ Download Compliance PDF
                </button>
                <button id="mint-nft" class="btn btn-outline" style="display: none;">
                    ğŸ¨ Mint NFT Reward
                </button>
                <button id="x-alerts" class="btn btn-ghost" style="display: none;">
                    ğŸ¦ Check X Alerts
                </button>
            </div>
        </section>

        <!-- Results Dashboard -->
        <section id="results" class="results-dashboard" aria-label="Audit results and findings">
            <h3>ğŸ“Š Audit Results</h3>
            
            <!-- Risk Score -->
            <div class="risk-score-placeholder" role="status" aria-live="polite">
                <p>
                    Risk Score: <span id="risk-score" aria-label="Risk score out of 100">N/A</span>/100
                </p>
            </div>

            <!-- Mobile-Only: Simplified Results View -->
            <div class="mobile-results-prompt" id="mobile-results-prompt">

                <!-- Mobile View for PAID users (Starter+) - PDF Download -->
                <div class="mobile-results-card mobile-paid-view" id="mobile-paid-view" style="display: none;">
                    <div class="mobile-results-icon">ğŸ“„</div>
                    <h4>Your Report is Ready</h4>
                    <p>Download your comprehensive PDF report with detailed findings, code analysis, and remediation steps.</p>
                    <button id="mobile-pdf-download" class="btn btn-primary mobile-pdf-btn">
                        ğŸ“„ Download Full PDF Report
                    </button>
                    <div class="mobile-results-summary" id="mobile-severity-summary-paid">
                        <!-- Populated by JS with severity counts -->
                    </div>
                    <p class="mobile-hint">View on desktop for interactive results</p>
                </div>

                <!-- Mobile View for FREE users - Issues List + Upgrade CTA -->
                <div class="mobile-results-card mobile-free-view" id="mobile-free-view" style="display: none;">
                    <div class="mobile-results-icon">ğŸ”</div>
                    <h4>Audit Complete</h4>

                    <div class="mobile-results-summary" id="mobile-severity-summary-free">
                        <!-- Populated by JS with severity counts -->
                    </div>

                    <div class="mobile-issues-list" id="mobile-issues-list">
                        <!-- Populated by JS with simplified issue list -->
                    </div>

                    <div class="mobile-upgrade-cta">
                        <p>ğŸ“„ Want a professional PDF security report?</p>
                        <a href="#audit" class="btn btn-primary mobile-upgrade-btn" onclick="document.getElementById('tier-select').value='starter'; document.getElementById('tier-switch').click();">
                            ğŸš€ Upgrade to Developer - $99/mo
                        </a>
                        <p class="mobile-upgrade-hint">Full vulnerability analysis, AI-powered fixes & compliance scoring</p>
                    </div>

                    <p class="mobile-hint">View on desktop for full interactive results</p>
                </div>
            </div>

            <!-- Desktop: Full Results (hidden on mobile) -->
            <div class="desktop-results-content">

            <!-- Executive Summary (Pro+) -->
            <div id="executive-summary" class="executive-summary-box" style="display: none; margin: var(--space-6) 0; padding: var(--space-5); background: var(--glass-bg); border-left: 4px solid var(--accent-teal); border-radius: var(--radius-lg);">
                <!-- Content populated by JavaScript -->
            </div>

            <!-- Severity Counts -->
            <div id="severity-counts" class="severity-counts-container" style="display: none; margin: var(--space-4) 0; display: flex; gap: var(--space-3); flex-wrap: wrap;">
                <!-- Content populated by JavaScript -->
            </div>

            <!-- On-Chain Analysis Results (Pro/Enterprise) -->
            <div id="onchain-analysis" class="onchain-analysis-section" style="display: none; margin: var(--space-6) 0;">
                <h4>â›“ï¸ On-Chain Analysis</h4>
                <div class="onchain-grid">
                    <!-- Proxy Detection -->
                    <div class="onchain-card" id="onchain-proxy">
                        <div class="onchain-card-header">
                            <span class="onchain-icon">ğŸ”„</span>
                            <span class="onchain-title">Proxy Status</span>
                        </div>
                        <div class="onchain-card-body" id="onchain-proxy-content">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Storage/Ownership -->
                    <div class="onchain-card" id="onchain-storage">
                        <div class="onchain-card-header">
                            <span class="onchain-icon">ğŸ‘¤</span>
                            <span class="onchain-title">Ownership & Access</span>
                        </div>
                        <div class="onchain-card-body" id="onchain-storage-content">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Backdoor Detection -->
                    <div class="onchain-card" id="onchain-backdoors">
                        <div class="onchain-card-header">
                            <span class="onchain-icon">ğŸš¨</span>
                            <span class="onchain-title">Backdoor Scan</span>
                        </div>
                        <div class="onchain-card-body" id="onchain-backdoors-content">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Honeypot Detection -->
                    <div class="onchain-card" id="onchain-honeypot">
                        <div class="onchain-card-header">
                            <span class="onchain-icon">ğŸ¯</span>
                            <span class="onchain-title">Honeypot Check</span>
                        </div>
                        <div class="onchain-card-body" id="onchain-honeypot-content">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Overall On-Chain Risk -->
                <div class="onchain-overall-risk" id="onchain-overall-risk">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Upgrade Prompt (Free Tier) -->
            <div id="upgrade-prompt" class="upgrade-prompt-container" style="display: none; margin: var(--space-6) 0;">
                <!-- Content populated by JavaScript -->
            </div>

            <!-- Issues Table - Enhanced for Pro/Enterprise -->
            <div class="issues-table-placeholder">
                <h4>ğŸ› Identified Issues</h4>
                <div class="table-responsive">
                    <table role="table" aria-describedby="issues-desc" class="issues-table-enhanced">
                        <thead>
                            <tr>
                                <th scope="col" style="width: 100px;">Severity</th>
                                <th scope="col" style="width: 150px;">Type</th>
                                <th scope="col">Description</th>
                                <th scope="col" style="width: 200px;">Quick Fix</th>
                                <th scope="col" style="width: 100px;">Details</th>
                            </tr>
                        </thead>
                        <tbody id="issues-body">
                            <tr>
                                <td colspan="5" style="text-align: center; color: var(--text-tertiary); padding: var(--space-8);">
                                    No issues yet. Submit an audit to see results.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <small id="issues-desc">
                    Vulnerabilities classified by severity: Low (ğŸŸ¢) | Medium (ğŸŸ¡) | High (ğŸ”´) | Critical (âš ï¸)
                    <br>
                    <strong>Pro/Enterprise:</strong> Click "Details" on any issue for line-by-line analysis, exploit scenarios, and code fixes
                </small>
            </div>

            <!-- Code Quality Metrics (Pro+) -->
            <div id="code-quality-metrics" class="code-quality-section" style="display: none; margin: var(--space-6) 0;">
                <h4>ğŸ“ˆ Code Quality Metrics</h4>
                <!-- Content populated by JavaScript -->
            </div>

            <!-- Risk Predictions -->
            <div class="predictions-placeholder">
                <h4>ğŸ”® Risk Predictions</h4>
                <ul id="predictions-list" role="list">
                    <li>No predictions yet. Results will appear after analysis.</li>
                </ul>
            </div>

            <!-- Recommendations - Categorized by Urgency -->
            <div class="recommendations-placeholder">
                <h4>ğŸ’¡ Security Recommendations</h4>
                <div id="recommendations-list" role="list" class="recommendations-container">
                    <p style="color: var(--text-tertiary); padding: var(--space-4);">No recommendations yet. Results will appear after analysis.</p>
                </div>
                <small style="color: var(--text-tertiary); font-size: var(--text-sm);">
                    Recommendations are prioritized: ğŸš¨ Immediate â†’ âš ï¸ Short-term â†’ ğŸ’¡ Long-term
                </small>
            </div>

            <!-- Fuzzing Results (Pro/Enterprise) -->
            <div class="fuzzing-placeholder pro-enterprise-only" style="display: none;">
                <h4>ğŸ§ª Fuzzing Results</h4>
                <div id="fuzzing-list" role="region" aria-label="Echidna fuzzing results">
                    <div class="fuzzing-empty">
                        <p>ğŸ§ª No fuzzing results yet.</p>
                    </div>
                </div>
            </div>

            <!-- Formal Verification Results (Enterprise only) -->
            <div class="certora-placeholder enterprise-only" style="display: none;">
                <h4>ğŸ”’ Formal Verification</h4>
                <div id="certora-list" role="region" aria-label="Certora formal verification results">
                    <div class="certora-empty">
                        <p>ğŸ”’ No formal verification results yet.</p>
                    </div>
                </div>
            </div>

            <!-- Remediation Roadmap (Enterprise) -->
            <div class="remediation-placeholder enterprise-only" style="display: none;">
                <h4>ğŸ—ºï¸ Remediation Roadmap</h4>
                <ul id="remediation-roadmap" role="list" aria-label="Security remediation steps">
                    <li>No roadmap yet. Results will appear after analysis.</li>
                </ul>
            </div>

            </div><!-- End desktop-results-content -->
        </section>

    </main>

    <!-- Wallet Selection Modal -->
    <div class="modal-backdrop" id="wallet-modal-backdrop" style="display: none;"></div>
    <div class="modal wallet-modal" id="wallet-modal" role="dialog" aria-labelledby="wallet-modal-title" aria-modal="true" style="display: none; max-width: 420px;">
        <button class="modal-close" id="wallet-modal-close" aria-label="Close wallet selector">Ã—</button>

        <div class="modal-header" style="text-align: center; padding-bottom: var(--space-4);">
            <h2 class="modal-title" id="wallet-modal-title">Connect Wallet</h2>
            <p style="margin-top: var(--space-2); color: var(--text-tertiary); font-size: var(--text-sm);">
                Select a wallet to import your deployed contracts
            </p>
        </div>

        <div class="modal-body" style="padding: 0 var(--space-6) var(--space-6);">
            <!-- Detected Browser Wallets (EIP-6963) -->
            <div id="detected-wallets-section">
                <div class="wallet-section-label">Detected Wallets</div>
                <div id="detected-wallets-list" class="wallet-list">
                    <!-- Populated dynamically -->
                </div>
            </div>

            <!-- Popular Wallets -->
            <div id="popular-wallets-section" style="margin-top: var(--space-4);">
                <div class="wallet-section-label">Popular Wallets</div>
                <div class="wallet-list">
                    <button class="wallet-option" data-wallet="metamask">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask" class="wallet-icon">
                        <span class="wallet-name">MetaMask</span>
                        <span class="wallet-tag" id="metamask-tag"></span>
                    </button>
                    <button class="wallet-option" data-wallet="coinbase">
                        <img src="https://avatars.githubusercontent.com/u/18060234?s=200&v=4" alt="Coinbase Wallet" class="wallet-icon">
                        <span class="wallet-name">Coinbase Wallet</span>
                        <span class="wallet-tag" id="coinbase-tag"></span>
                    </button>
                    <button class="wallet-option" data-wallet="walletconnect">
                        <img src="https://avatars.githubusercontent.com/u/37784886?s=200&v=4" alt="WalletConnect" class="wallet-icon">
                        <span class="wallet-name">WalletConnect</span>
                        <span class="wallet-tag mobile-tag">Mobile & 300+ wallets</span>
                    </button>
                </div>
            </div>

            <!-- WalletConnect QR Section (hidden by default) -->
            <div id="walletconnect-qr-section" style="display: none; margin-top: var(--space-4);">
                <div class="wallet-section-label">Scan with your wallet app</div>
                <div id="walletconnect-qr-container" class="qr-container">
                    <div class="qr-loading">Generating QR code...</div>
                </div>
                <button id="walletconnect-back" class="btn btn-secondary" style="width: 100%; margin-top: var(--space-4);">
                    â† Back to wallet list
                </button>
            </div>

            <!-- No Wallet Detected Message -->
            <div id="no-wallet-message" style="display: none; text-align: center; padding: var(--space-6); color: var(--text-tertiary);">
                <div style="font-size: 2rem; margin-bottom: var(--space-3);">ğŸ”—</div>
                <p style="margin-bottom: var(--space-4);">No browser wallet detected</p>
                <p style="font-size: var(--text-sm);">
                    On mobile? Use <strong>WalletConnect</strong> below or open this page in your wallet app's browser.
                </p>
            </div>
        </div>
    </div>

    <!-- Queue Monitor Modal -->
    <div class="modal-backdrop" id="queue-modal-backdrop"></div>
    <div class="modal" id="queue-modal" role="dialog" aria-labelledby="queue-modal-title" aria-modal="true" style="max-width: 900px;">
        <button class="modal-close" id="queue-modal-close" aria-label="Close queue monitor">Ã—</button>
        
        <div class="modal-header">
            <h2 class="modal-title" id="queue-modal-title">â³ Queue Monitor</h2>
            <p style="margin-top: 8px; color: var(--text-tertiary); font-size: var(--text-sm);">
                Real-time audit queue status
                <span class="queue-refresh-indicator" style="margin-left: var(--space-3);">
                    <span class="queue-dot" style="display: inline-block; width: 8px; height: 8px; background: var(--success); border-radius: 50%; animation: queueBlink 2s infinite;"></span>
                    <span style="margin-left: var(--space-1);">Auto-refresh every 3s</span>
                </span>
            </p>
        </div>
        
        <div class="modal-body" style="padding: var(--space-6);">
            <!-- Main Stats Grid -->
            <div class="queue-stats-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-4); margin-bottom: var(--space-6);">
                <div class="queue-stat-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-4); text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: var(--space-2);">âš¡</div>
                    <div id="queue-stat-processing" style="font-size: var(--text-3xl); font-weight: 800; background: linear-gradient(135deg, var(--warning), #fbbf24); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">0</div>
                    <div style="font-size: var(--text-xs); color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.05em;">Processing</div>
                </div>
                <div class="queue-stat-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-4); text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: var(--space-2);">â³</div>
                    <div id="queue-stat-queued" style="font-size: var(--text-3xl); font-weight: 800; background: var(--gradient-accent); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">0</div>
                    <div style="font-size: var(--text-xs); color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.05em;">In Queue</div>
                </div>
                <div class="queue-stat-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-4); text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: var(--space-2);">âœ…</div>
                    <div id="queue-stat-completed" style="font-size: var(--text-3xl); font-weight: 800; color: var(--success);">0</div>
                    <div style="font-size: var(--text-xs); color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.05em;">Completed</div>
                </div>
                <div class="queue-stat-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-4); text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: var(--space-2);">âŒ</div>
                    <div id="queue-stat-failed" style="font-size: var(--text-3xl); font-weight: 800; color: var(--error);">0</div>
                    <div style="font-size: var(--text-xs); color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.05em;">Failed</div>
                </div>
            </div>
            
            <!-- Queue by Tier -->
            <div class="queue-tier-section" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-xl); padding: var(--space-5); margin-bottom: var(--space-6);">
                <h3 style="font-size: var(--text-lg); color: var(--accent-teal); margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
                    ğŸ“Š Queue by Tier (Priority Order)
                </h3>
                <div class="queue-tier-bars" style="display: flex; flex-direction: column; gap: var(--space-3);">
                    <div class="queue-tier-row" style="display: flex; align-items: center; gap: var(--space-3);">
                        <span style="width: 80px; font-weight: 600; color: var(--text-secondary); font-size: var(--text-sm);">Enterprise</span>
                        <div style="flex: 1; height: 24px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden; border: 1px solid var(--glass-border);">
                            <div id="queue-bar-enterprise" style="height: 100%; width: 0%; background: linear-gradient(135deg, #a855f7, #ec4899); border-radius: var(--radius-full); transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: var(--space-2); min-width: 0;">
                                <span id="queue-count-enterprise" style="font-weight: 700; font-size: var(--text-xs); color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">0</span>
                            </div>
                        </div>
                        <span id="queue-value-enterprise" style="width: 30px; text-align: right; font-weight: 700; color: var(--text-primary);">0</span>
                    </div>
                    <div class="queue-tier-row" style="display: flex; align-items: center; gap: var(--space-3);">
                        <span style="width: 80px; font-weight: 600; color: var(--text-secondary); font-size: var(--text-sm);">Pro</span>
                        <div style="flex: 1; height: 24px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden; border: 1px solid var(--glass-border);">
                            <div id="queue-bar-pro" style="height: 100%; width: 0%; background: linear-gradient(135deg, var(--warning), #fbbf24); border-radius: var(--radius-full); transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: var(--space-2); min-width: 0;">
                                <span id="queue-count-pro" style="font-weight: 700; font-size: var(--text-xs); color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">0</span>
                            </div>
                        </div>
                        <span id="queue-value-pro" style="width: 30px; text-align: right; font-weight: 700; color: var(--text-primary);">0</span>
                    </div>
                    <div class="queue-tier-row" style="display: flex; align-items: center; gap: var(--space-3);">
                        <span style="width: 80px; font-weight: 600; color: var(--text-secondary); font-size: var(--text-sm);">Starter</span>
                        <div style="flex: 1; height: 24px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden; border: 1px solid var(--glass-border);">
                            <div id="queue-bar-starter" style="height: 100%; width: 0%; background: linear-gradient(135deg, var(--accent-teal), var(--accent-teal-light)); border-radius: var(--radius-full); transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: var(--space-2); min-width: 0;">
                                <span id="queue-count-starter" style="font-weight: 700; font-size: var(--text-xs); color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">0</span>
                            </div>
                        </div>
                        <span id="queue-value-starter" style="width: 30px; text-align: right; font-weight: 700; color: var(--text-primary);">0</span>
                    </div>
                    <div class="queue-tier-row" style="display: flex; align-items: center; gap: var(--space-3);">
                        <span style="width: 80px; font-weight: 600; color: var(--text-secondary); font-size: var(--text-sm);">Free</span>
                        <div style="flex: 1; height: 24px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden; border: 1px solid var(--glass-border);">
                            <div id="queue-bar-free" style="height: 100%; width: 0%; background: linear-gradient(135deg, #6b7280, #9ca3af); border-radius: var(--radius-full); transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: var(--space-2); min-width: 0;">
                                <span id="queue-count-free" style="font-weight: 700; font-size: var(--text-xs); color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">0</span>
                            </div>
                        </div>
                        <span id="queue-value-free" style="width: 30px; text-align: right; font-weight: 700; color: var(--text-primary);">0</span>
                    </div>
                </div>
                <p style="margin-top: var(--space-3); font-size: var(--text-xs); color: var(--text-muted);">
                    â„¹ï¸ Higher tiers are processed first (Enterprise â†’ Pro â†’ Starter â†’ Free)
                </p>
            </div>
            
            <!-- System Health -->
            <div class="queue-health-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-4);">
                <div class="queue-health-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-4);">
                    <h4 style="font-size: var(--text-sm); color: var(--text-tertiary); margin-bottom: var(--space-2);">ğŸ–¥ï¸ Server Status</h4>
                    <div id="queue-server-status" style="display: flex; align-items: center; gap: var(--space-2); font-size: var(--text-lg); font-weight: 600; color: var(--success);">
                        <span class="queue-health-dot" style="width: 10px; height: 10px; background: var(--success); border-radius: 50%; box-shadow: 0 0 8px var(--success); animation: queuePulse 2s infinite;"></span>
                        <span>Healthy</span>
                    </div>
                    <p style="font-size: var(--text-xs); color: var(--text-muted); margin-top: var(--space-2);">
                        Max Concurrent: <strong id="queue-max-concurrent">1</strong>
                    </p>
                </div>
                <div class="queue-health-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-4);">
                    <h4 style="font-size: var(--text-sm); color: var(--text-tertiary); margin-bottom: var(--space-2);">âš¡ Throughput</h4>
                    <div style="font-size: var(--text-lg); font-weight: 600; color: var(--accent-teal);">
                        ~25/hr
                    </div>
                    <p style="font-size: var(--text-xs); color: var(--text-muted); margin-top: var(--space-2);">
                        Avg audit: <strong>~2 min</strong>
                    </p>
                </div>
                <div class="queue-health-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-4);">
                    <h4 style="font-size: var(--text-sm); color: var(--text-tertiary); margin-bottom: var(--space-2);">ğŸš¨ Queue Alert</h4>
                    <div id="queue-alert-status" style="display: flex; align-items: center; gap: var(--space-2); font-size: var(--text-lg); font-weight: 600; color: var(--success);">
                        <span id="queue-alert-dot" class="queue-health-dot" style="width: 10px; height: 10px; background: var(--success); border-radius: 50%; box-shadow: 0 0 8px var(--success);"></span>
                        <span id="queue-alert-text">Normal</span>
                    </div>
                    <p style="font-size: var(--text-xs); color: var(--text-muted); margin-top: var(--space-2);">
                        Alert at: <strong>15+ queued</strong>
                    </p>
                </div>
            </div>
            
            <!-- Last Update -->
            <p id="queue-last-update" style="text-align: center; font-size: var(--text-xs); color: var(--text-muted); margin-top: var(--space-4);">
                Last updated: --
            </p>
        </div>
    </div>
    
    <style>
        @keyframes queueBlink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }
        @keyframes queuePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        
        /* Responsive queue modal */
        @media (max-width: 768px) {
            #queue-modal .queue-stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            #queue-modal .queue-health-grid {
                grid-template-columns: 1fr !important;
            }
        }
    </style>

    <!-- Settings Modal (Outside main content, before footer) -->
    <div class="modal-backdrop" id="settings-modal-backdrop"></div>
    <div class="modal" id="settings-modal" role="dialog" aria-labelledby="settings-modal-title" aria-modal="true">
        <button class="modal-close" id="settings-modal-close" aria-label="Close settings">Ã—</button>
        
        <div class="modal-header">
            <h2 class="modal-title" id="settings-modal-title">âš™ï¸ Account Settings</h2>
        </div>
        
        <div class="modal-body">
            <!-- Account Info -->
            <div class="settings-section">
                <h3>ğŸ‘¤ Account Information</h3>
                <div class="settings-grid">
                    <div class="settings-item">
                        <label>Username:</label>
                        <span id="modal-username">Loading...</span>
                    </div>
                    <div class="settings-item">
                        <label>Email:</label>
                        <span id="modal-email">Loading...</span>
                    </div>
                    <div class="settings-item">
                        <label>Current Tier:</label>
                        <span id="modal-tier" class="badge">Loading...</span>
                    </div>
                    <div class="settings-item">
                        <label>Member Since:</label>
                        <span id="modal-member-since">Loading...</span>
                    </div>
                </div>
            </div>
            
            <!-- Usage Statistics -->
            <div class="settings-section">
                <h3>ğŸ“Š Usage Statistics</h3>
                <div class="settings-grid">
                    <div class="settings-item">
                        <label>Audits Used:</label>
                        <span id="modal-audits-used">Loading...</span>
                    </div>
                    <div class="settings-item">
                        <label>Audits Remaining:</label>
                        <span id="modal-audits-remaining">Loading...</span>
                    </div>
                    <div class="settings-item">
                        <label>File Size Limit:</label>
                        <span id="modal-size-limit">Loading...</span>
                    </div>
                </div>
                
                <!-- Usage Progress Bar -->
                <div class="usage-progress-container">
                    <div class="usage-progress-bar">
                        <div class="usage-progress-fill" id="modal-usage-progress"></div>
                    </div>
                    <small id="modal-usage-text" class="text-tertiary">0% used</small>
                </div>
            </div>
            
            <!-- Project Key Management (Pro/Enterprise only) -->
            <div class="settings-section" id="modal-api-section" style="display: none;">
                <h3>ğŸ“ Project Key Management</h3>
                <p style="font-size: var(--text-sm); color: var(--text-tertiary); margin: 0 0 var(--space-4) 0;">
                    Project Keys help you organize audits by client or project. Each key is tied to one file.
                    <span class="tooltip-trigger" title="Project Keys are different from Access Keys. Project Keys organize your audits, while Access Keys let you retrieve specific audit results.">â“˜ What's the difference?</span>
                </p>

                <!-- Tier limit info -->
                <div class="api-key-limit-info" style="margin-bottom: var(--space-4); padding: var(--space-3); background: var(--glass-bg); border-radius: var(--radius-md); font-size: var(--text-sm); color: var(--text-tertiary);">
                    <span id="api-key-count-display">Loading...</span>
                </div>

                <!-- Project Keys Table -->
                <div class="api-keys-table-container" style="margin-bottom: var(--space-6);">
                    <table class="api-keys-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid var(--glass-border);">
                                <th style="padding: var(--space-3); text-align: left; font-size: var(--text-sm); color: var(--text-tertiary);">Project Label</th>
                                <th style="padding: var(--space-3); text-align: left; font-size: var(--text-sm); color: var(--text-tertiary);">Key</th>
                                <th style="padding: var(--space-3); text-align: left; font-size: var(--text-sm); color: var(--text-tertiary);">Created</th>
                                <th style="padding: var(--space-3); text-align: left; font-size: var(--text-sm); color: var(--text-tertiary);">Audits</th>
                                <th style="padding: var(--space-3); text-align: right; font-size: var(--text-sm); color: var(--text-tertiary);">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="api-keys-table-body">
                            <tr>
                                <td colspan="5" style="padding: var(--space-6); text-align: center; color: var(--text-tertiary);">
                                    Loading project keys...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Create New Key Button -->
                <button id="create-api-key" class="btn" style="width: 100%;">
                    â• Create New Project Key
                </button>

                <small class="text-tertiary" style="display: block; margin-top: var(--space-4);">
                    Keep your project keys secure. Each key organizes audits for one file/project. Use different keys for different clients or contracts.
                </small>
            </div>
            
            <!-- Create Project Key Modal (nested) -->
            <div class="modal-backdrop" id="create-key-modal-backdrop" style="display: none; z-index: calc(var(--z-modal) + 1);"></div>
            <div class="modal" id="create-key-modal" style="display: none; z-index: calc(var(--z-modal) + 2); max-width: 500px;">
                <button class="modal-close" id="create-key-modal-close">Ã—</button>
                <div class="modal-header">
                    <h3 class="modal-title">Create New Project Key</h3>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="new-key-label">Project/Client Name</label>
                        <input type="text" id="new-key-label" placeholder="e.g., Uniswap Audit, Client ABC, TokenX" style="width: 100%; padding: var(--space-3); background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-md); color: var(--text-primary);">
                        <small class="text-tertiary">Name this key after the project or client. Each key can only audit one file.</small>
                    </div>
                    <div style="display: flex; gap: var(--space-3); margin-top: var(--space-6);">
                        <button id="create-key-confirm" class="btn" style="flex: 1;">Create Key</button>
                        <button id="create-key-cancel" class="btn btn-secondary" style="flex: 1;">Cancel</button>
                    </div>
                </div>
            </div>
            
            <!-- Audit History & Retrieval (Pro/Enterprise) -->
            <div class="settings-section" id="modal-audit-history-section">
                <h3>ğŸ”‘ Audit History & Retrieval</h3>

                <div class="audit-history-info" style="margin-bottom: var(--space-4); padding: var(--space-3); background: var(--glass-bg); border-radius: var(--radius-md); font-size: var(--text-sm); color: var(--text-tertiary);">
                    <p style="margin: 0 0 8px 0;">
                        <strong>Background Audits</strong> - Start an audit, leave the page, and retrieve results anytime with your <strong>Access Key</strong> (starts with <code>dga_</code>).
                    </p>
                    <p style="margin: 0; color: var(--accent-teal);">
                        ğŸ“§ Pro/Enterprise users receive email notifications when audits complete.
                    </p>
                </div>

                <!-- Retrieve by Access Key -->
                <div class="audit-retrieve-section" style="border: 2px dashed var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-6); text-align: center; background: var(--glass-bg); margin-bottom: var(--space-4);">
                    <div style="margin-bottom: var(--space-3);">
                        <span style="font-size: 2rem;">ğŸ”‘</span>
                    </div>
                    <p style="margin: 0 0 12px 0; color: var(--text-secondary);">
                        Have an <strong>Access Key</strong>? Retrieve your audit results:
                    </p>
                    <div style="display: flex; gap: var(--space-2); max-width: 400px; margin: 0 auto;">
                        <input type="text" id="settings-audit-key-input" placeholder="dga_..."
                               style="flex: 1; font-family: 'JetBrains Mono', monospace; padding: var(--space-3); background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-md); color: var(--text-primary);"
                               aria-label="Access Key">
                        <button id="settings-retrieve-btn" class="btn" style="min-width: 120px;">
                            ğŸ” Retrieve
                        </button>
                    </div>
                    <small style="display: block; margin-top: var(--space-3); color: var(--text-tertiary);">
                        Access Keys are provided when you submit an audit. They look like: <code>dga_abc123...</code>
                    </small>
                </div>

                <!-- Recent Audits List -->
                <div id="settings-recent-audits" style="margin-top: var(--space-4);">
                    <h4 style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: var(--text-sm);">Recent Audits (stored locally)</h4>
                    <div id="settings-recent-audits-list" style="display: flex; flex-direction: column; gap: var(--space-2);">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Theme Selection -->
            <div class="settings-section">
                <h3>ğŸ¨ Theme & Appearance</h3>
                <div class="theme-selector">
                    <label for="theme-select">Choose Theme:</label>
                    <select id="theme-select" class="theme-dropdown">
                        <option value="default">Default Dark (Teal & Pink)</option>
                        <option value="ocean">Ocean Blue</option>
                        <option value="purple">Purple Haze</option>
                        <option value="matrix">Matrix Green</option>
                        <option value="midnight">Midnight Black</option>
                    </select>
                </div>
                <div class="theme-preview-container">
                    <div class="theme-preview-card">
                        <div class="theme-preview-header">Preview</div>
                        <div class="theme-preview-content">
                            <div class="theme-preview-accent"></div>
                            <div class="theme-preview-text">Sample text in selected theme</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->            
            <div class="settings-section">
                <h3>âš¡ Quick Actions</h3>
                <div class="settings-actions">
                    <button id="modal-upgrade" class="btn btn-outline">
                        â¬†ï¸ Upgrade Plan
                    </button>
                    <button id="modal-logout" class="btn btn-secondary">
                        ğŸšª Log Out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer role="contentinfo">
        <p>&copy; 2026 DeFiGuard AI. Built with FastAPI, Claude AI & â¤ï¸</p>
        <p>
            <a href="/privacy" style="color: var(--accent-teal);">Privacy Policy</a> | 
            <a href="/terms" style="color: var(--accent-teal);">Terms of Service</a>
        </p>
    </footer>

    <!-- Scripts - Cache-busted dynamic loading -->
    <!-- Ethers.js for wallet connection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.9.0/ethers.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- QR Code library for WalletConnect -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- WalletConnect EthereumProvider -->
    <script type="module">
        import { EthereumProvider } from 'https://esm.sh/@walletconnect/ethereum-provider@2.13.0';

        window.WalletConnectProvider = EthereumProvider;
        window.WALLETCONNECT_PROJECT_ID = '079a6f8f37edf022e707aff4a34ca1d8';
        window.WALLETCONNECT_METADATA = {
            name: 'DeFiGuard AI',
            description: 'Smart Contract Security Auditor',
            url: 'https://defiguard-ai-beta.onrender.com',
            icons: ['https://defiguard-ai-beta.onrender.com/static/logo.png']
        };

        // Dispatch event when WalletConnect is ready
        window.dispatchEvent(new Event('walletconnect-ready'));
    </script>
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script>
        // Cache-bust CSS and JS using safe DOM manipulation (no document.write)
        (function() {
            const timestamp = new Date().getTime();

            // Add CSS link dynamically
            const cssLink = document.createElement('link');
            cssLink.rel = 'stylesheet';
            cssLink.href = '/static/styles.css?v=' + timestamp;
            document.head.appendChild(cssLink);

            // Add script dynamically
            const scriptTag = document.createElement('script');
            scriptTag.src = '/static/script.js?v=' + timestamp;
            document.head.appendChild(scriptTag);
        })();
    </script>
    <!-- Queue Monitor Modal Script -->
    <script>
    (function() {
        // Queue Monitor Modal Elements
        const queueModalBackdrop = document.getElementById('queue-modal-backdrop');
        const queueModal = document.getElementById('queue-modal');
        const queueModalClose = document.getElementById('queue-modal-close');
        const openQueueMonitor = document.getElementById('open-queue-monitor');
        
        let queueRefreshInterval = null;
        let prevQueueStats = null;
        
        // Open Queue Monitor
        if (openQueueMonitor) {
            openQueueMonitor.addEventListener('click', function(e) {
                e.preventDefault();
                openQueueModal();
            });
        }
        
        // Close handlers
        if (queueModalClose) {
            queueModalClose.addEventListener('click', closeQueueModal);
        }
        if (queueModalBackdrop) {
            queueModalBackdrop.addEventListener('click', closeQueueModal);
        }
        
        // ESC key to close
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && queueModal && queueModal.style.display === 'block') {
                closeQueueModal();
            }
        });
        
        function openQueueModal() {
            if (queueModalBackdrop) queueModalBackdrop.style.display = 'block';
            if (queueModal) queueModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Start fetching stats
            fetchQueueStats();
            queueRefreshInterval = setInterval(fetchQueueStats, 3000);
        }
        
        function closeQueueModal() {
            if (queueModalBackdrop) queueModalBackdrop.style.display = 'none';
            if (queueModal) queueModal.style.display = 'none';
            document.body.style.overflow = '';
            
            // Stop refreshing
            if (queueRefreshInterval) {
                clearInterval(queueRefreshInterval);
                queueRefreshInterval = null;
            }
        }
        
        async function fetchQueueStats() {
            try {
                const response = await fetch('/audit/queue-stats');
                if (!response.ok) throw new Error('Failed to fetch');
                
                const stats = await response.json();
                
                // Update main stats
                const processing = document.getElementById('queue-stat-processing');
                const queued = document.getElementById('queue-stat-queued');
                const completed = document.getElementById('queue-stat-completed');
                const failed = document.getElementById('queue-stat-failed');
                
                if (processing) processing.textContent = stats.processing || 0;
                if (queued) queued.textContent = stats.queued || 0;
                if (completed) completed.textContent = stats.completed || 0;
                if (failed) failed.textContent = stats.failed || 0;
                
                // Update max concurrent
                const maxConcurrent = document.getElementById('queue-max-concurrent');
                if (maxConcurrent) maxConcurrent.textContent = stats.max_concurrent || 1;
                
                // Update tier bars
                const tiers = stats.queued_by_tier || {};
                const totalQueued = stats.queued || 0;
                const maxBar = Math.max(totalQueued, 10);
                
                ['enterprise', 'pro', 'starter', 'free'].forEach(tier => {
                    const count = tiers[tier] || 0;
                    const percent = maxBar > 0 ? (count / maxBar) * 100 : 0;
                    
                    const bar = document.getElementById(`queue-bar-${tier}`);
                    const countEl = document.getElementById(`queue-count-${tier}`);
                    const valueEl = document.getElementById(`queue-value-${tier}`);
                    
                    if (bar) bar.style.width = `${Math.max(percent, count > 0 ? 15 : 0)}%`;
                    if (countEl) countEl.textContent = count;
                    if (valueEl) valueEl.textContent = count;
                });
                
                // Update queue alert
                updateQueueAlert(stats.queued || 0);
                
                // Update server status
                updateServerStatus(true);
                
                // Update last update time
                const lastUpdate = document.getElementById('queue-last-update');
                if (lastUpdate) {
                    lastUpdate.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                }
                
                prevQueueStats = stats;
                
            } catch (error) {
                console.error('Queue stats fetch error:', error);
                updateServerStatus(false);
            }
        }
        
        function updateQueueAlert(queueDepth) {
            const alertDot = document.getElementById('queue-alert-dot');
            const alertText = document.getElementById('queue-alert-text');
            const alertStatus = document.getElementById('queue-alert-status');
            
            if (!alertDot || !alertText || !alertStatus) return;
            
            if (queueDepth >= 15) {
                alertDot.style.background = 'var(--error)';
                alertDot.style.boxShadow = '0 0 8px var(--error)';
                alertText.textContent = 'High Load';
                alertStatus.style.color = 'var(--error)';
            } else if (queueDepth >= 8) {
                alertDot.style.background = 'var(--warning)';
                alertDot.style.boxShadow = '0 0 8px var(--warning)';
                alertText.textContent = 'Elevated';
                alertStatus.style.color = 'var(--warning)';
            } else {
                alertDot.style.background = 'var(--success)';
                alertDot.style.boxShadow = '0 0 8px var(--success)';
                alertText.textContent = 'Normal';
                alertStatus.style.color = 'var(--success)';
            }
        }
        
        function updateServerStatus(isOnline) {
            const statusEl = document.getElementById('queue-server-status');
            if (!statusEl) return;
            
            const dot = statusEl.querySelector('.queue-health-dot');
            const text = statusEl.querySelector('span:last-child');
            
            if (isOnline) {
                if (dot) {
                    dot.style.background = 'var(--success)';
                    dot.style.boxShadow = '0 0 8px var(--success)';
                }
                if (text) text.textContent = 'Healthy';
                statusEl.style.color = 'var(--success)';
            } else {
                if (dot) {
                    dot.style.background = 'var(--error)';
                    dot.style.boxShadow = '0 0 8px var(--error)';
                }
                if (text) text.textContent = 'Offline';
                statusEl.style.color = 'var(--error)';
            }
        }
    })();
    </script>
    <!-- Legal Acceptance Modal (First-Time Users) -->
    <div id="legal-modal-backdrop" class="modal-backdrop" style="display: none;"></div>
    <div id="legal-modal" class="settings-modal" style="display: none; z-index: 10001;">
        <div class="settings-modal-content" style="max-width: 800px; max-height: 90vh;">
            <!-- Header -->
            <div class="settings-modal-header">
                <h2>ğŸ“„ Welcome to DeFiGuard AI</h2>
                <p style="margin-top: 8px; color: var(--text-tertiary); font-size: var(--text-sm);">
                    Before you begin, please review and accept our legal agreements
                </p>
            </div>

            <!-- Scrollable Content -->
            <div class="settings-modal-body" style="max-height: 60vh; overflow-y: auto; padding: var(--space-6);" id="legal-scroll-container">
                <!-- Terms of Service Section -->
                <div style="margin-bottom: var(--space-8);">
                    <h3 style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-4);">
                        <input type="checkbox" id="accept-terms-checkbox" style="width: 20px; height: 20px; cursor: pointer;">
                        <label for="accept-terms-checkbox" style="cursor: pointer; font-weight: 600;">
                            I have read and agree to the Terms of Service
                        </label>
                    </h3>
                    <div style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-4); max-height: 300px; overflow-y: auto;">
                        <iframe src="/static/terms-of-service.html" style="width: 100%; height: 250px; border: none;"></iframe>
                        <a href="/static/terms-of-service.html" target="_blank" style="display: block; margin-top: var(--space-2); color: var(--accent-teal); text-decoration: none; font-size: var(--text-sm);">
                            ğŸ“„ Open in new tab
                        </a>
                    </div>
                </div>

                <!-- Privacy Policy Section -->
                <div style="margin-bottom: var(--space-6);">
                    <h3 style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-4);">
                        <input type="checkbox" id="accept-privacy-checkbox" style="width: 20px; height: 20px; cursor: pointer;">
                        <label for="accept-privacy-checkbox" style="cursor: pointer; font-weight: 600;">
                            I have read and agree to the Privacy Policy
                        </label>
                    </h3>
                    <div style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-4); max-height: 300px; overflow-y: auto;">
                        <iframe src="/static/privacy-policy.html" style="width: 100%; height: 250px; border: none;"></iframe>
                        <a href="/static/privacy-policy.html" target="_blank" style="display: block; margin-top: var(--space-2); color: var(--accent-teal); text-decoration: none; font-size: var(--text-sm);">
                            ğŸ”’ Open in new tab
                        </a>
                    </div>
                </div>

                <!-- Important Notice -->
                <div style="background: var(--glass-bg); border-left: 4px solid var(--accent-purple); padding: var(--space-4); border-radius: var(--radius-md); margin-bottom: var(--space-6);">
                    <p style="margin: 0; font-size: var(--text-sm); color: var(--text-secondary);">
                        <strong>âš ï¸ Important:</strong> By checking the boxes above and clicking "I Accept," you acknowledge that:
                    </p>
                    <ul style="margin: var(--space-2) 0 0 var(--space-5); font-size: var(--text-sm); color: var(--text-tertiary);">
                        <li>You have read and understood both documents</li>
                        <li>You agree to be legally bound by these terms</li>
                        <li>DeFiGuard AI provides automated analysis tools, not security guarantees</li>
                        <li>You are solely responsible for code you deploy to production</li>
                    </ul>
                </div>
            </div>

            <!-- Footer with Action Buttons -->
            <div class="settings-modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
                <button id="legal-decline" class="btn btn-secondary">
                    Decline
                </button>
                <button id="legal-accept" class="btn" disabled style="opacity: 0.5; cursor: not-allowed;">
                    I Accept
                </button>
            </div>
        </div>
    </div>

    <!-- Billing Interval Toggle Script -->
    <script>
    (function() {
        const billingToggle = document.getElementById('billing-interval-toggle');
        const billingIntervalInput = document.getElementById('billing-interval');
        const monthlyLabel = document.getElementById('billing-monthly-label');
        const annualLabel = document.getElementById('billing-annual-label');
        const tierSelect = document.getElementById('tier-select');
        const toggleSlider = document.querySelector('.toggle-slider');

        // Pricing data for both intervals (with conversion-optimized labels)
        const pricing = {
            monthly: {
                starter: { label: 'â­ Developer - $99/month (Most Popular)', amount: '$99' },
                pro: { label: 'ğŸ† Team - $349/month (Best Value - 68% choose this)', amount: '$349' },
                enterprise: { label: 'ğŸ’¼ Enterprise - $1,499/month (Protocol-Grade)', amount: '$1,499' }
            },
            annual: {
                starter: { label: 'â­ Developer - $990/year (SAVE $198)', amount: '$990' },
                pro: { label: 'ğŸ† Team - $3,490/year (SAVE $698 - Best Value)', amount: '$3,490' },
                enterprise: { label: 'ğŸ’¼ Enterprise - $14,990/year (SAVE $2,998)', amount: '$14,990' }
            }
        };

        // Annual savings displayed in table
        const annualSavings = {
            starter: 'SAVE $198 (2 months FREE)',
            pro: 'SAVE $698 (2 months FREE)',
            enterprise: 'SAVE $2,998 (2 months FREE)'
        };

        function updatePricingDisplay(interval) {
            // Update hidden input
            if (billingIntervalInput) {
                billingIntervalInput.value = interval;
            }

            // Update labels styling with smooth transition
            if (interval === 'annual') {
                if (monthlyLabel) {
                    monthlyLabel.style.fontWeight = '500';
                    monthlyLabel.style.color = 'var(--text-secondary)';
                }
                if (annualLabel) {
                    annualLabel.style.fontWeight = '600';
                    annualLabel.style.color = 'var(--green)';
                }
                if (toggleSlider) {
                    toggleSlider.style.background = 'var(--green)';
                }
            } else {
                if (monthlyLabel) {
                    monthlyLabel.style.fontWeight = '600';
                    monthlyLabel.style.color = 'var(--accent)';
                }
                if (annualLabel) {
                    annualLabel.style.fontWeight = '500';
                    annualLabel.style.color = 'var(--text-secondary)';
                }
                if (toggleSlider) {
                    toggleSlider.style.background = 'var(--bg-tertiary)';
                }
            }

            // Update tier select options
            if (tierSelect) {
                const currentValue = tierSelect.value;
                Array.from(tierSelect.options).forEach(opt => {
                    const tier = opt.value;
                    if (pricing[interval][tier]) {
                        opt.textContent = pricing[interval][tier].label;
                    }
                });
                tierSelect.value = currentValue;
            }

            // Update pricing table amounts and suffixes
            const pricingAmounts = document.querySelectorAll('.pricing-table .pricing-amount');
            const pricingSuffixes = document.querySelectorAll('.pricing-table .pricing-suffix');
            const pricingAnnuals = document.querySelectorAll('.pricing-table .pricing-annual');

            const amounts = interval === 'annual'
                ? ['$0', '$990', '$3,490', '$14,990']
                : ['$0', '$99', '$349', '$1,499'];
            const suffixes = interval === 'annual'
                ? ['', '/yr', '/yr', '/yr']
                : ['', '/mo', '/mo', '/mo'];
            const annualTexts = interval === 'annual'
                ? ['', 'or $82.50/mo billed annually', 'or $291/mo billed annually', 'or $1,249/mo billed annually']
                : ['', 'or $990/yr (2 months FREE)', 'or $3,490/yr (SAVE $698)', 'or $14,990/yr (SAVE $2,998)'];

            pricingAmounts.forEach((el, idx) => {
                el.textContent = amounts[idx];
            });

            pricingSuffixes.forEach((el, idx) => {
                if (suffixes[idx]) {
                    el.textContent = suffixes[idx];
                }
            });

            pricingAnnuals.forEach((el, idx) => {
                if (annualTexts[idx]) {
                    el.textContent = annualTexts[idx];
                }
            });

            console.log(`[BILLING] Switched to ${interval} billing`);
        }

        // Toggle switch event listener
        if (billingToggle) {
            billingToggle.addEventListener('change', function() {
                const interval = this.checked ? 'annual' : 'monthly';
                updatePricingDisplay(interval);
            });

            // Add toggle knob styling and animations
            const style = document.createElement('style');
            style.textContent = `
                .toggle-slider:before {
                    position: absolute;
                    content: "";
                    height: 22px;
                    width: 22px;
                    left: 4px;
                    bottom: 4px;
                    background: white;
                    border-radius: 50%;
                    transition: 0.3s;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                }
                #billing-interval-toggle:checked + .toggle-slider:before {
                    transform: translateX(30px);
                }

                /* Pulse animation for urgency elements */
                @keyframes pulse {
                    0%, 100% { opacity: 1; transform: scale(1); }
                    50% { opacity: 0.8; transform: scale(1.05); }
                }

                /* Hover effect for upgrade button */
                #tier-switch:hover {
                    transform: translateY(-2px) scale(1.02);
                    box-shadow: 0 8px 25px rgba(39, 174, 96, 0.5);
                }

                #tier-switch:active {
                    transform: translateY(0) scale(0.98);
                }

                /* Recommended tier glow */
                .recommended-tier {
                    position: relative;
                }

                .recommended-tier::before {
                    content: "RECOMMENDED";
                    position: absolute;
                    top: -12px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: var(--green);
                    color: white;
                    padding: 2px 12px;
                    border-radius: 12px;
                    font-size: 10px;
                    font-weight: 800;
                    letter-spacing: 1px;
                }

                /* Price highlight on hover */
                .pricing-table tbody tr:hover {
                    background: rgba(52, 152, 219, 0.05);
                }

                .pricing-table tbody tr.recommended-tier:hover {
                    background: linear-gradient(135deg, rgba(39, 174, 96, 0.18), rgba(46, 204, 113, 0.12));
                }
            `;
            document.head.appendChild(style);
        }
    })();
    </script>

</body>
</html>