services:
  - type: web
    name: defiguard-ai-beta  # MUST match your exact service name in dashboard
    env: python
    region: oregon
    plan: starter
    branch: main
    
    buildCommand: |
      echo "=========================================="
      echo "ðŸ”§ Installing Python dependencies..."
      echo "=========================================="
      pip install --upgrade pip
      pip install -r requirements.txt
      
      echo "=========================================="
      echo "ðŸ”§ Installing solc compiler..."
      echo "=========================================="
      pip install solc-select
      python -m solc_select install 0.8.24
      python -m solc_select use 0.8.24
      
      echo "=========================================="
      echo "ðŸ”§ Installing Echidna via Docker method..."
      echo "=========================================="
      # Install Docker CLI tools
      apt-get update
      apt-get install -y curl
      
      # Download and extract Echidna binary directly
      mkdir -p /opt/render/project/.local/bin
      cd /tmp
      curl -L https://github.com/crytic/echidna/releases/latest/download/echidna-x86_64-linux -o echidna
      chmod +x echidna
      mv echidna /opt/render/project/.local/bin/
      /opt/render/project/.local/bin/echidna --version || echo "Echidna installation pending verification"
      
      echo "=========================================="
      echo "âœ… Build complete!"
      echo "=========================================="
    
    startCommand: |
      export PATH="/opt/render/project/.local/bin:$PATH"
      /opt/render/project/src/.venv/bin/python -m gunicorn main:app --workers 1 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --timeout 120 --log-level info
    
    envVars:
      - key: PYTHON_VERSION
        value: "3.13.4"
      - key: ENVIRONMENT
        value: "production"
      # AI API Keys (at least one required)
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: GROK_API_KEY
        sync: false
      # Auth0 Configuration (required)
      - key: AUTH0_DOMAIN
        sync: false
      - key: AUTH0_CLIENT_ID
        sync: false
      - key: AUTH0_CLIENT_SECRET
        sync: false
      # Stripe Configuration (required)
      - key: STRIPE_API_KEY
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_PUBLISHABLE_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      # Stripe Price IDs
      - key: STRIPE_PRICE_PRO
        sync: false
      - key: STRIPE_PRICE_STARTER
        sync: false
      - key: STRIPE_PRICE_ENTERPRISE
        sync: false
      - key: STRIPE_PRICE_BEGINNER
        sync: false
      - key: STRIPE_PRICE_DIAMOND
        sync: false
      - key: STRIPE_METERED_PRICE_DIAMOND
        sync: false
      # Blockchain Configuration (required)
      - key: INFURA_PROJECT_ID
        sync: false
      - key: WEB3_PROVIDER_URL
        sync: false
      # Database (required)
      - key: DATABASE_URL
        sync: false
      # Redis (required)
      - key: REDIS_URL
        sync: false
      # Security (required)
      - key: APP_SECRET_KEY
        sync: false
      - key: ADMIN_KEY
        sync: false